# 自定义功能使用说明

## 功能概述

已在主翻译视图的设置标签页中添加"自定义"标签，整合了桌面项目的三大核心功能：

1. **一键处理** - 自动完成 替换→压缩→转移 三步骤
2. **名称映射管理** - 管理生肉和熟肉漫画名称对应关系  
3. **章节分析** - 分析文件夹中所有漫画的最新章节

---

## 功能位置

```
主翻译视图
└── 右侧面板
    └── 设置标签页
        ├── 基础设置
        ├── 高级设置
        ├── 选项
        └── 自定义 ⭐ (新增)
            ├── 一键处理 (标签页)
            └── 名称映射管理 (标签页)
```

---

## 一、一键处理

### 功能说明
自动执行以下三个步骤：
1. **提取组织** - 从 `_source_path.txt` 提取漫画名并使用映射表替换
2. **CBZ压缩** - 将章节文件夹压缩为 .cbz 文件
3. **文件转移** - 转移 CBZ 到存储文件夹

### 使用步骤
1. 设置 **输入文件夹**（翻译输出文件夹）
2. 设置 **输出文件夹**（最终存储文件夹）
3. 点击 **[开始一键处理]**
4. 查看实时处理进度和结果

### 输入文件夹结构
```
翻译输出文件夹/
├── Chapter 1/          # 散乱的章节文件夹
│   ├── _source_path.txt  # 记录源路径（包含漫画名）
│   ├── 001.png
│   └── 002.png
├── Chapter 2/
└── ...
```

### 输出文件夹结构
```
存储文件夹/
├── 漫画名1/
│   ├── Chapter 1.cbz
│   ├── Chapter 2.cbz
│   └── ...
└── 漫画名2/
```

---

## 二、名称映射管理

### 功能说明
管理生肉和熟肉漫画名称的对应关系，支持多种语言名称映射到同一中文名。

### 使用方法

#### 添加映射
1. 点击 **[添加映射]** 按钮
2. 输入 **生肉名称**（如英文、日文、韩文名）
3. 输入 **熟肉名称**（如中文名）
4. 映射自动保存到 `name_mapping.json`

#### 删除映射
1. 在表格中选中要删除的映射
2. 点击 **[删除映射]** 按钮

#### 刷新列表
点击 **[刷新列表]** 重新加载映射表

### 映射示例
```
生肉名称                        熟肉名称
──────────────────────────────────────
Seishun Buta Yarou          → 青春猪头少年
Kaguya-sama                 → 辉夜大小姐想让我告白
Solo Leveling               → 我独自升级
```

### 配置文件
映射数据保存在 `d:\漫画\1\name_mapping.json`

---

## 三、章节分析

### 功能说明
扫描指定文件夹，统计每部漫画的章节数量和最新章节。

### 使用步骤
1. 设置 **要分析的文件夹**
2. 点击 **[开始分析]** 按钮
3. 查看分析报告

### 输入文件夹结构
```
分析文件夹/
├── 漫画名1/
│   ├── Chapter 1/
│   ├── Chapter 2/
│   ├── Chapter 1.cbz
│   └── Chapter 2.cbz
└── 漫画名2/
    ├── Chapter 10/
    └── Chapter 10.cbz
```

### 分析报告示例
```
==================================================
章节分析报告
分析时间: 2025-11-09 20:00:00
==================================================

【青春猪头少年】
  最新章节: Chapter 15
  共 15 话

【辉夜大小姐想让我告白】
  最新章节: Chapter 280
  共 280 话

总计: 2 部漫画
==================================================
```

---

## 完整工作流程示例

### 场景：翻译完成后整理漫画

1. **翻译完成**
   - 翻译后的图片保存在翻译输出文件夹
   - 每个章节文件夹包含 `_source_path.txt`

2. **设置名称映射**（首次使用）
   - 打开"自定义"标签页
   - 在"名称映射管理"中添加映射关系
   - 例如：`Seishun Buta Yarou` → `青春猪头少年`

3. **执行一键处理**
   - 输入文件夹：`D:\漫画\通过翻译后输出文件夹`
   - 输出文件夹：`D:\漫画\已翻译`
   - 点击"开始一键处理"
   - 自动完成：提取漫画名 → 压缩CBZ → 转移文件

4. **分析最新进度**
   - 在"章节分析"中设置文件夹
   - 点击"开始分析"
   - 查看每部漫画的最新章节和总话数

---

## 依赖文件

以下文件已复制到项目中：
- `desktop_qt_ui/utils/name_replacer.py` - 名称替换器
- `desktop_qt_ui/utils/cbz_compressor.py` - CBZ压缩器
- `desktop_qt_ui/utils/cbz_transfer.py` - 文件转移器
- `desktop_qt_ui/utils/one_click_processor.py` - 一键处理器
- `desktop_qt_ui/utils/comic_analyzer.py` - 章节分析器
- `desktop_qt_ui/widgets/custom_comic_panel.py` - 自定义面板UI

---

## 注意事项

1. **备份数据** - 首次使用前建议备份重要文件
2. **路径正确** - 确保文件夹路径存在且可访问
3. **_source_path.txt** - 一键处理依赖此文件提取漫画名
4. **映射优先** - 添加好名称映射后再执行一键处理
5. **已处理记录** - CBZ压缩会记录已处理的文件夹，避免重复

---

## 故障排查

### 无法加载处理模块
- 检查 `desktop_qt_ui/utils/` 目录是否包含所有依赖文件
- 重启程序

### 一键处理无效果
- 确认输入文件夹中有章节文件夹
- 检查章节文件夹中是否有 `_source_path.txt`
- 确认有添加对应的名称映射

### 映射不生效
- 检查 `name_mapping.json` 文件是否存在
- 点击"刷新列表"重新加载
- 确认生肉名称完全匹配

---

## 快速入门

**最简单的使用方式：**

1. 在"自定义"标签添加一个映射：
   - 生肉：`Test Manga`
   - 熟肉：`测试漫画`

2. 准备测试文件夹结构：
   ```
   D:\test_input\
   └── Chapter 1\
       ├── _source_path.txt  (内容: D:\downloads\Test Manga\Chapter 1)
       ├── 001.png
       └── 002.png
   ```

3. 一键处理：
   - 输入：`D:\test_input`
   - 输出：`D:\test_output`
   - 点击"开始一键处理"

4. 结果：
   ```
   D:\test_output\
   └── 测试漫画\
       └── Chapter 1.cbz
   ```

---

**🎉 享受高效的漫画管理体验！**

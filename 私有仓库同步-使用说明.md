# 私有仓库同步工具 - 使用说明

## 📋 功能特性

### ✨ 新增优化（v2.0）

1. **✅ 智能错误检查**
   - 自动检查PowerShell脚本是否存在
   - 验证是否在Git仓库中运行
   - 详细的错误提示和解决建议

2. **🚀 快捷参数支持**
   - 支持命令行参数快速执行
   - 无需交互式选择，提高效率

3. **⚡ 智能暂停逻辑**
   - 成功时自动关闭窗口
   - 失败时自动暂停显示错误
   - 可通过环境变量控制

4. **📝 完善的文档**
   - 显示所有分支信息
   - 提供使用示例
   - 清晰的帮助信息

## 🎯 使用方法

### 方法一：交互式运行（推荐新手）

直接双击 `私有仓库同步.bat`，然后按提示操作：

```
1. 选择分支（don / my-custom-features / qwe）
2. 选择操作（推送 / 拉取）
3. 等待完成
```

### 方法二：快捷参数（推荐高级用户）

**格式：**
```batch
私有仓库同步.bat [分支名] [操作]
```

**示例：**

```batch
# 拉取don分支最新代码
私有仓库同步.bat don pull

# 推送qwe分支到远程
私有仓库同步.bat qwe push

# 拉取my-custom-features分支
私有仓库同步.bat my-custom-features pull
```

### 方法三：创建快捷方式

为常用操作创建桌面快捷方式：

**快捷方式1：快速拉取don分支**
- 目标：`D:\漫画\1\私有仓库同步.bat don pull`
- 名称：`🔄 拉取don分支`

**快捷方式2：快速推送qwe分支**
- 目标：`D:\漫画\1\私有仓库同步.bat qwe push`
- 名称：`⬆️ 推送qwe分支`

## 📌 分支说明

| 分支名 | 功能描述 | 使用场景 |
|--------|---------|---------|
| **don** | 新四线流水线：删除分段+修复并发 | 核心翻译流水线功能开发 |
| **my-custom-features** | UI功能（漫画管理面板+CBZ工具等） | UI界面和工具功能开发 |
| **qwe** | 长图拼接功能（智能拼接+翻译count mismatch修复） | 长图处理功能开发 |

## ⚙️ 高级配置

### 1. 成功后保持窗口打开

如果希望即使成功也暂停窗口，可以设置环境变量：

**临时设置（当前会话）：**
```batch
set PAUSE_ON_SUCCESS=1
私有仓库同步.bat don pull
```

**永久设置（系统环境变量）：**
1. 右键"此电脑" → 属性 → 高级系统设置
2. 环境变量 → 用户变量 → 新建
3. 变量名：`PAUSE_ON_SUCCESS`，变量值：`1`

### 2. 集成到右键菜单（可选）

创建注册表文件 `添加到右键.reg`：

```reg
Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT\Directory\Background\shell\GitSync]
@="Git 仓库同步"
"Icon"="C:\\Windows\\System32\\shell32.dll,16"

[HKEY_CLASSES_ROOT\Directory\Background\shell\GitSync\command]
@="\"D:\\漫画\\1\\私有仓库同步.bat\""
```

双击运行后，在任意文件夹空白处右键即可看到"Git 仓库同步"选项。

## 🔧 故障排除

### 问题1：找不到PowerShell脚本

**错误信息：**
```
[错误] 找不到PowerShell脚本: 私有仓库同步.ps1
```

**解决方法：**
确保以下两个文件在同一目录：
- `私有仓库同步.bat`
- `私有仓库同步.ps1`

### 问题2：不是Git仓库

**错误信息：**
```
[警告] 当前目录似乎不是Git仓库
```

**解决方法：**
1. 确认当前目录包含 `.git` 文件夹
2. 如果是新克隆的仓库，运行 `git init`

### 问题3：执行策略限制

**错误信息：**
```
无法加载文件，因为在此系统上禁止运行脚本
```

**解决方法：**
脚本已使用 `-ExecutionPolicy Bypass` 参数，通常不会遇到此问题。
如果仍有问题，以管理员身份运行PowerShell：
```powershell
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### 问题4：编码错误（特殊字符显示乱码）

**解决方法：**
- 脚本已设置 `chcp 65001` UTF-8编码
- 如果仍有问题，确保终端字体支持中文（如：Microsoft YaHei UI）

## 📊 版本历史

### v2.0 (2025-11-17)
- ✨ 添加命令行参数支持
- ✨ 智能错误检查和提示
- ✨ 优化暂停逻辑（成功时自动关闭）
- ✨ 添加分支qwe的说明
- 📝 完善使用文档

### v1.0 (2025-11-16)
- 🎉 初始版本
- ⚡ 基础的交互式分支选择
- ⚡ 支持推送和拉取操作

## 💡 最佳实践

1. **推送前检查**：使用 `git status` 确认要提交的文件
2. **拉取后测试**：拉取代码后运行基本测试确保功能正常
3. **定期同步**：建议每天开始工作前先拉取最新代码
4. **冲突解决**：遇到合并冲突时，仔细查看冲突内容再决定保留哪个版本
5. **提交信息**：写清晰的提交信息，方便以后查找

## 🔗 相关链接

- 远程仓库：https://gitee.com/long-xin12/manga-translator-ui.git
- Git 官方文档：https://git-scm.com/doc
- PowerShell 文档：https://docs.microsoft.com/powershell/

## 📞 获取帮助

如果遇到问题：
1. 查看上方的"故障排除"章节
2. 检查Git状态：`git status`
3. 查看详细日志：`git log --oneline -10`
4. 查看远程连接：`git remote -v`

# 私有仓库同步工具使用说明

## 📋 功能说明

这是一个用于同步Gitee私有仓库的自动化工具，支持推送和拉取操作。

**远程仓库**: `https://gitee.com/long-xin12/manga-translator-ui.git`  
**首选分支**: `my-custom-features`

---

## 🚀 快速开始

### 方法1：双击运行（推荐）

```
双击运行: 私有仓库同步.bat
```

### 方法2：PowerShell命令行

```powershell
# 拉取
.\私有仓库同步.ps1 -Action pull

# 推送
.\私有仓库同步.ps1 -Action push
```

---

## 🔍 智能功能

### 1. 自动添加远程仓库

如果当前Git仓库没有配置 `my-private` 远程仓库：
- ✅ 脚本会自动检测并询问是否添加
- ✅ 输入 `Y` 自动配置远程仓库
- ✅ 无需手动配置

### 2. 智能分支处理

**情况A：本地有 `my-custom-features` 分支**
- ✅ 自动切换到该分支
- ✅ 执行同步操作

**情况B：本地无此分支，但远程有**
- ✅ 询问是否创建本地分支
- ✅ 输入 `Y` 自动创建并切换
- ✅ 输入其他键使用当前分支

**情况C：本地和远程都没有**
- ✅ 使用当前分支进行同步
- ✅ 不会报错

### 3. 自动暂存/恢复

- ✅ 切换分支前自动暂存修改
- ✅ 操作完成后自动恢复
- ✅ 避免丢失未提交的修改

---

## 📊 使用场景

### 场景1：`d:\漫画\1` 目录（主开发）

**特点**：
- ✅ 已配置 `my-private` 远程仓库
- ✅ 已有 `my-custom-features` 分支
- ✅ 开箱即用

**操作**：
```
1. 双击 私有仓库同步.bat
2. 选择 1(推送) 或 2(拉取)
3. 完成！
```

### 场景2：`d:\漫画\manga-translator-gpu-v1.7.4` 目录（其他环境）

**特点**：
- ❌ 初始没有 `my-private` 远程仓库
- ❌ 初始没有 `my-custom-features` 分支
- ✅ 脚本会自动处理

**首次运行流程**：
```
1. 双击 私有仓库同步.bat
2. 选择操作 (2-拉取)
3. 脚本提示：是否添加远程仓库? 输入 Y
4. 脚本提示：是否创建分支? 输入 Y
5. 完成！后续使用与场景1相同
```

---

## 🎯 操作说明

### 拉取操作 (Pull)

**作用**：从Gitee私有仓库拉取最新代码

**流程**：
1. 检查远程仓库配置
2. 暂存本地未提交的修改
3. 切换到目标分支
4. 拉取远程最新代码
5. 恢复暂存的修改
6. 显示最近的提交

**适用场景**：
- ✅ 需要更新代码到最新版本
- ✅ 同步其他机器的修改
- ✅ 获取团队成员的更新

### 推送操作 (Push)

**作用**：将本地修改推送到Gitee私有仓库

**流程**：
1. 检查未提交的修改
2. 自动提交（或手动输入提交信息）
3. 推送到远程仓库
4. 显示最近的提交

**适用场景**：
- ✅ 保存当前工作进度
- ✅ 与其他机器同步代码
- ✅ 备份重要修改

---

## 📝 输出示例

### 成功的拉取操作

```
[信息] 脚本运行目录: D:\漫画\1
[成功] Git已安装: git version 2.51.1.windows.1
[成功] 远程仓库: https://gitee.com/long-xin12/manga-translator-ui.git
[信息] 当前分支: my-custom-features
[成功] 已在分支 my-custom-features

========================================
执行操作: 拉取
========================================

[拉取] 获取远程更新...
[拉取] 从 my-private/my-custom-features 拉取...
Already up to date.
[成功] 拉取完成

[信息] 最近的提交:
* a123226 - chore: 更新配置示例文件
* 42a77d0 - feat: v2.5.7 分段并行翻译 + 可配置分段阈值
* 8774c27 - feat: 实现四线流水线功能

========================================
操作成功完成！
========================================
```

### 首次配置（添加远程仓库）

```
[警告] 未找到远程仓库 'my-private'
[信息] 当前远程仓库列表:
origin  https://github.com/hgmzhn/manga-translator-ui.git (fetch)
origin  https://github.com/hgmzhn/manga-translator-ui.git (push)

[询问] 是否要添加远程仓库 'my-private' ?
[信息] URL: https://gitee.com/long-xin12/manga-translator-ui.git
输入 Y 添加，其他键跳过: Y
[成功] 已添加远程仓库 'my-private'
```

### 创建本地分支

```
[信息] 本地不存在分支 'my-custom-features'，但远程有此分支
[询问] 是否要创建并切换到 'my-custom-features' 分支?
输入 Y 创建，其他键使用当前分支: Y
[成功] 已创建并切换到 'my-custom-features'
```

---

## ⚠️ 注意事项

### 1. 未提交的修改

- ✅ 脚本会自动暂存
- ✅ 操作完成后自动恢复
- ⚠️ 如果恢复时有冲突，需要手动解决

### 2. 合并冲突

如果拉取时出现冲突：
```bash
[警告] 恢复时发生冲突
[信息] 请手动解决冲突: git status
[信息] 解决后运行: git add . && git commit
```

**解决步骤**：
1. 运行 `git status` 查看冲突文件
2. 打开冲突文件手动解决
3. 运行 `git add .` 标记已解决
4. 运行 `git commit` 提交

### 3. 网络问题

如果遇到 `credential-manager-core` 警告：
- ✅ 这是正常的，不影响功能
- ✅ 可以忽略此警告
- ✅ Git操作仍会正常执行

---

## 🔧 故障排除

### 问题1：找不到Git

**错误信息**：
```
[错误] 未找到Git
```

**解决方案**：
1. 确保Git已安装
2. 将Git添加到系统PATH
3. 重启命令行/PowerShell

### 问题2：推送失败

**错误信息**：
```
[错误] 推送失败
[信息] 可能需要先拉取
```

**解决方案**：
1. 先运行拉取操作
2. 解决可能的冲突
3. 再次推送

### 问题3：分支切换失败

**错误信息**：
```
[错误] 切换分支失败
```

**解决方案**：
1. 检查是否有未提交的修改
2. 手动暂存: `git stash`
3. 重新运行脚本

---

## 📚 相关命令

如果需要手动操作：

```bash
# 查看远程仓库
git remote -v

# 添加远程仓库
git remote add my-private https://gitee.com/long-xin12/manga-translator-ui.git

# 查看所有分支
git branch -a

# 创建并切换分支
git checkout -b my-custom-features my-private/my-custom-features

# 拉取
git pull my-private my-custom-features

# 推送
git push my-private my-custom-features
```

---

## 🎉 总结

**优点**：
- ✅ 全自动配置
- ✅ 智能分支处理
- ✅ 保护未提交的修改
- ✅ 清晰的提示信息
- ✅ 适用多个仓库

**使用建议**：
1. 首次运行时按提示添加配置
2. 日常使用只需双击bat文件
3. 遇到冲突按提示手动解决
4. 定期拉取保持代码最新

---

**文档版本**: v1.0  
**最后更新**: 2025-11-16  
**作者**: Windsurf Cascade
